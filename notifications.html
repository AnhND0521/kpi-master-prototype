<!DOCTYPE html>
<head>
    <title>KPI Master</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="./styles.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico?v=1">
</head>
<body>

<div style="width: 1440px; height: 1024px; position: relative; background: white">

    <!-- Notifications -->
    <div id="noti-list" style="width: 1104px; height: 945px; left: 337px; top: 79px; position: absolute">
      <!-- <div style="width: 375px; height: 25px; left: 59px; top: 57px; position: absolute; color: black; font-size: 32px; font-family: Arial; font-weight: 500; word-wrap: break-word">Thông báo</div> -->
      <!-- <div style="width: 73px; height: 30px; left: 914px; top: 108px; position: absolute; cursor: pointer;">
        <div style="width: 40px; height: 16px; left: 33px; top: 3px; position: absolute; color: black; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Lọc</div>
        <div style="width: 22px; height: 22px; left: 0px; top: 0px; position: absolute; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: inline-flex">
          <img style="width: 22px; height: 19.25px;" src="img/icon-filter.png">
        </div>
      </div> -->
      <!-- <div class="link" style="width: 391px; height: 22px; left: 59px; top: 108px; position: absolute; color: #7E56DA; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Đánh dấu tất cả là đã đọc</div> -->
      <!-- <div style="width: 928px; height: 119px; left: 59px; top: 156px; position: absolute">
        <div style="width: 921.99px; height: 119px; left: 6.01px; top: 0px; position: absolute; background: rgba(231.87, 218.58, 251.80, 0.50); border-radius: 10px"></div>
        <div style="width: 117.13px; height: 21.97px; left: 47px; top: 68px; position: absolute; color: #7E56DA; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Chi tiết</div>
        <div style="width: 12px; height: 119px; left: 0px; top: 0px; position: absolute; background: #EAB045; border-radius: 10px"></div>
        <div style="width: 762px; height: 29px; left: 47px; top: 22px; position: absolute; color: #343839; font-size: 22px; font-family: Arial; font-weight: 600; word-wrap: break-word">Task 2 đến hạn vào hôm nay! Bạn nhớ hoàn thành nhé!</div>
        <div style="width: 156.17px; height: 29.29px; left: 726.78px; top: 21.97px; position: absolute; text-align: right; color: #9D8686; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">0:21 AM</div>
      </div>
      <div style="width: 928px; height: 119px; left: 59px; top: 290px; position: absolute">
        <div style="width: 921.99px; height: 119px; left: 6.01px; top: 0px; position: absolute; background: rgba(231.87, 218.58, 251.80, 0.50); border-radius: 10px"></div>
        <div style="width: 117.13px; height: 21.97px; left: 47px; top: 68px; position: absolute; color: #7E56DA; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Chi tiết</div>
        <div style="width: 12px; height: 119px; left: 0px; top: 0px; position: absolute; background: #EAB045; border-radius: 10px"></div>
        <div style="width: 762px; height: 29px; left: 47px; top: 22px; position: absolute; color: #343839; font-size: 22px; font-family: Arial; font-weight: 600; word-wrap: break-word">Task 2 đến hạn vào hôm nay! Bạn nhớ hoàn thành nhé!</div>
        <div style="width: 156.17px; height: 29.29px; left: 726.78px; top: 21.97px; position: absolute; text-align: right; color: #9D8686; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">0:21 AM</div>
      </div>
      <div style="width: 928px; height: 119px; left: 59px; top: 424px; position: absolute">
        <div style="width: 921.99px; height: 119px; left: 6.01px; top: 0px; position: absolute; background: rgba(243, 237, 252, 0.50); border-radius: 10px"></div>
        <div style="width: 117.13px; height: 21.97px; left: 47px; top: 68px; position: absolute; color: #7E56DA; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Chi tiết</div>
        <div style="width: 12px; height: 119px; left: 0px; top: 0px; position: absolute; background: #FF5E5E; border-radius: 10px"></div>
        <div style="width: 762px; height: 29px; left: 47px; top: 22px; position: absolute; color: #343839; font-size: 22px; font-family: Arial; font-weight: 400; word-wrap: break-word">Task X đã bị quá hạn! Hãy hoàn thành trước khi quá muộn!</div>
        <div style="width: 156.17px; height: 29.29px; left: 726.78px; top: 21.97px; position: absolute; text-align: right; color: #9D8686; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Hôm qua</div>
      </div>
      <div style="width: 928px; height: 119px; left: 59px; top: 558px; position: absolute">
        <div style="width: 921.99px; height: 119px; left: 6.01px; top: 0px; position: absolute; background: rgba(243, 237, 252, 0.50); border-radius: 10px"></div>
        <div style="width: 117.13px; height: 21.97px; left: 47px; top: 68px; position: absolute; color: #7E56DA; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Chi tiết</div>
        <div style="width: 12px; height: 119px; left: 0px; top: 0px; position: absolute; background: #EAB045; border-radius: 10px"></div>
        <div style="width: 762px; height: 29px; left: 47px; top: 22px; position: absolute; color: #343839; font-size: 22px; font-family: Arial; font-weight: 400; word-wrap: break-word">Task Y đến hạn vào hôm nay! Bạn nhớ hoàn thành nhé!</div>
        <div style="width: 156.17px; height: 29.29px; left: 726.78px; top: 21.97px; position: absolute; text-align: right; color: #9D8686; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Hôm qua</div>
      </div>
      <div style="width: 928px; height: 119px; left: 59px; top: 692px; position: absolute">
        <div style="width: 921.99px; height: 119px; left: 6.01px; top: 0px; position: absolute; background: rgba(243, 237, 252, 0.50); border-radius: 10px"></div>
        <div style="width: 117.13px; height: 21.97px; left: 47px; top: 68px; position: absolute; color: #7E56DA; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Chi tiết</div>
        <div style="width: 12px; height: 119px; left: 0px; top: 0px; position: absolute; background: #FF5E5E; border-radius: 10px"></div>
        <div style="width: 762px; height: 29px; left: 47px; top: 22px; position: absolute; color: #343839; font-size: 22px; font-family: Arial; font-weight: 400; word-wrap: break-word">Task A đã bị quá hạn! Hãy hoàn thành trước khi quá muộn!</div>
        <div style="width: 156.17px; height: 29.29px; left: 726.78px; top: 21.97px; position: absolute; text-align: right; color: #9D8686; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Hôm kia</div>
      </div>
      <div style="width: 928px; height: 119px; left: 59px; top: 826px; position: absolute">
        <div style="width: 921.99px; height: 119px; left: 6.01px; top: 0px; position: absolute; background: rgba(243, 237, 252, 0.50); border-radius: 10px"></div>
        <div style="width: 117.13px; height: 21.97px; left: 47px; top: 68px; position: absolute; color: #7E56DA; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Chi tiết</div>
        <div style="width: 12px; height: 119px; left: 0px; top: 0px; position: absolute; background: #EAB045; border-radius: 10px"></div>
        <div style="width: 762px; height: 29px; left: 47px; top: 22px; position: absolute; color: #343839; font-size: 22px; font-family: Arial; font-weight: 400; word-wrap: break-word">Task B đến hạn vào hôm nay! Bạn nhớ hoàn thành nhé!</div>
        <div style="width: 156.17px; height: 29.29px; left: 726.78px; top: 21.97px; position: absolute; text-align: right; color: #9D8686; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Hôm kia</div>
      </div> -->
    </div>


    <!-- Sidebar -->
    <div style="width: 336px; height: 1024px; left: 0px; top: 79px; position: fixed; opacity: 0.80; background: #078D70; z-index: 1;">
        <div style="width: 336px; height: 1024px; left: 0px; top: 0px; position: absolute; background: #F5F5F5;  box-shadow: 1px 0px 8px rgba(0, 0, 0, 0.25)"></div>
        <div class="nav-link" id="nav-kpi-list" style="width: 336px; height: 72px; left: 0px; top: 88px; position: absolute">
            <div style="width: 312px; height: 56px; left: 12px; top: 8px; position: absolute; border-radius: 10px"></div>
            <img style="width: 24px; height: 24px; left: 25px; top: 24px; position: absolute" src="img/icon-kpi-list.png" />
            <div style="left: 61px; top: 25px; position: absolute; color: black; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Danh sách KPI</div>
        </div>
        <div class="nav-link" id="nav-schedule" style="width: 336px; height: 72px; left: 0px; top: 160px; position: absolute">
            <div style="width: 312px; height: 56px; left: 12px; top: 8px; position: absolute; border-radius: 10px"></div>
            <div style="left: 61px; top: 25px; position: absolute; color: black; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Lịch trình</div>
            <img style="width: 24px; height: 24px; left: 25px; top: 24px; position: absolute" src="img/icon-schedule.png" />
        </div>
        <div class="nav-link" id="nav-home" style="width: 336px; height: 72px; left: 0px; top: 16px; position: absolute">
            <div style="width: 312px; height: 56px; left: 12px; top: 8px; position: absolute; border-radius: 10px"></div>
            <div style="left: 61px; top: 25px; position: absolute; color: black; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Trang chủ</div>
            <img style="width: 28px; height: 28px; left: 22px; top: 19px; position: absolute" src="img/icon-home.png" />
        </div>
        <div class="nav-link" id="nav-noti" style="width: 336px; height: 72px; left: 0px; top: 232px; position: absolute; background: #F8E4FF">
            <div style="width: 312px; height: 56px; left: 12px; top: 8px; position: absolute; border-radius: 10px"></div>
            <div style="left: 61px; top: 25px; position: absolute; color: #603EBB; font-size: 18px; font-family: Arial; font-weight: 700; word-wrap: break-word">Thông báo</div>
            <img style="width: 30px; height: 30px; left: 22px; top: 21px; position: absolute" src="img/icon-notification-active.png" />
            <div style="width: 24px; height: 24px; left: 162px; top: 24px; position: absolute">
                <div style="width: 24px; height: 24px; left: 0px; top: 0px; position: absolute; background: #7E56DA; border-radius: 5px"></div>
                <div style="left: 7px; top: 2px; position: absolute; text-align: center; color: white; font-size: 16px; font-family: Arial; font-weight: 700; word-wrap: break-word">2</div>
            </div>
        </div>
        <div class="nav-link" id="nav-settings" style="width: 336px; height: 72px; left: 0px; top: 304px; position: absolute">
            <div style="width: 312px; height: 56px; left: 12px; top: 8px; position: absolute; border-radius: 10px"></div>
            <div style="left: 61px; top: 25px; position: absolute; color: black; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Cài đặt</div>
            <img style="width: 24px; height: 23.98px; left: 25px; top: 24px; position: absolute" src="img/icon-settings.png" />
        </div>
    </div>
  </div>

  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="data.js"></script>
  <script src="common.js"></script>
  <script>
    setHeader();

    function randomInt(min, max) {
        return Math.floor(Math.random() * (max - min)) + min;
    }
    function randomTime() {
        const h = randomInt(1,13);
        const m = randomInt(0,60);
        const x = randomInt(0,2) === 0 ? 'AM' : 'PM';
        return `${h<10?'0':''}${h}:${m<10?'0':''}${m} ${x}`;
    }

    const notiList = $("#noti-list");
    const tasks = getAllTasks();
    console.log(tasks);
    const notis = tasks.filter(t => t.status !== 1).map(t => {return {
        type: t.status,
        content: t.status === 0 ? `Nhiệm vụ '${t.name}' đến hạn vào hôm nay! Bạn nhớ hoàn thành nhé!` : `Nhiệm vụ '${t.name}' đã bị quá hạn! Hãy hoàn thành trước khi quá muộn!`,
        time: randomTime(),
        read: randomInt(0,2)
    }});
    console.log(notis);

    function renderNotiList() {
        notiList.empty();
        notiList.append(`<div style="width: 375px; height: 25px; left: 59px; top: 50px; position: absolute; color: black; font-size: 32px; font-family: Arial; font-weight: 500; word-wrap: break-word">Thông báo</div>
      <!-- <div style="width: 73px; height: 30px; left: 914px; top: 108px; position: absolute; cursor: pointer;">
        <div style="width: 40px; height: 16px; left: 33px; top: 3px; position: absolute; color: black; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Lọc</div>
        <div style="width: 22px; height: 22px; left: 0px; top: 5px; position: absolute; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: inline-flex">
          <img style="width: 22px; height: 19.25px;" src="img/icon-filter.png">
        </div>
      </div> -->
      <div class="link" onclick="markAllAsRead()" style="width: 391px; height: 22px; left: 59px; top: 112px; position: absolute; color: #7E56DA; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Đánh dấu tất cả là đã đọc</div>`);

        let y = 156;
        let inc = 134;
        notis.forEach((n,i) => {
            notiList.append($(`<div index="${i}" style="width: 928px; height: 167px; left: 59px; top: ${y}px; position: absolute">
                <div style="width: 921.99px; height: 119px; left: 6.01px; top: 17px; position: absolute; background: ${n.read?'rgba(243, 237, 252, 0.50)':'rgba(231.87, 218.58, 251.80, 0.50)'}; border-radius: 10px"></div>
                <div class="link" style="width: 207.13px; height: 21.97px; left: 47px; top: 95px; position: absolute; color: #7E56DA; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word" onclick="markAsRead(event)">Đánh dấu là đã đọc</div>
                <div class="link" style="width: 307.13px; height: 21.97px; left: 247px; top: 95px; position: absolute; color: #7E56DA; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word" onclick="markAsRead(event)">Đánh dấu là đã hoàn thành</div>
                <div style="width: 12px; height: 119px; left: 0px; top: 17px; position: absolute; background: ${n.type===0?'#EAB045':'#FF5E5E'}; border-radius: 10px"></div>
                <div style="width: 762px; height: 29px; left: 47px; top: 34px; position: absolute; color: #343839; font-size: 20px; font-family: Arial; font-weight: ${n.read ? 400 : 600}; word-wrap: break-word">${n.content}</div>
                <div style="width: 156.17px; height: 29.29px; left: 736.78px; top: 38.97px; position: absolute; text-align: right; color: #9D8686; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">${n.time}</div>
            </div>`));
            y += inc;
        });
    }

    renderNotiList();

    function markAsRead(event) {
        const i = +$(event.target.parentNode).attr("index");
        notis[i].read = 1;
        renderNotiList();
    }

    function markAllAsRead() {
        notis.forEach(n => n.read = 1);
        renderNotiList();
    }
  </script>
</body>