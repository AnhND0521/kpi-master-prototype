<!DOCTYPE html>
<head>
    <title>KPI Master</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="./styles.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico?v=1">
</head>
<body>

    <div style="width: 1440px; height: 1024px; position: relative; background: white">


        <!-- Side bar -->
        <div style="width: 336px; height: 1024px; left: 0px; top: 79px; position: fixed; opacity: 0.80; background: #078D70; z-index: 1;">
            <div style="width: 336px; height: 1024px; left: 0px; top: 0px; position: absolute; background: #F5F5F5;  box-shadow: 1px 0px 8px rgba(0, 0, 0, 0.25)"></div>
            <div class="nav-link" id="nav-kpi-list" style="width: 336px; height: 72px; left: 0px; top: 88px; position: absolute; background: #F8E4FF">
                <div style="width: 312px; height: 56px; left: 12px; top: 8px; position: absolute; border-radius: 10px"></div>
                <img style="width: 24px; height: 24px; left: 25px; top: 24px; position: absolute" src="img/icon-kpi-list-active.png" />
                <div style="left: 61px; top: 25px; position: absolute; color: #603EBB; font-size: 18px; font-family: Arial; font-weight: 700; word-wrap: break-word">Danh sách KPI</div>
            </div>
            <div class="nav-link" id="nav-schedule" style="width: 336px; height: 72px; left: 0px; top: 160px; position: absolute">
                <div style="width: 312px; height: 56px; left: 12px; top: 8px; position: absolute; border-radius: 10px"></div>
                <div style="left: 61px; top: 25px; position: absolute; color: black; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Lịch trình</div>
                <img style="width: 24px; height: 24px; left: 25px; top: 24px; position: absolute" src="img/icon-schedule.png" />
            </div>
            <div class="nav-link" id="nav-home" style="width: 336px; height: 72px; left: 0px; top: 16px; position: absolute">
                <div style="width: 312px; height: 56px; left: 12px; top: 8px; position: absolute; border-radius: 10px"></div>
                <div style="left: 61px; top: 25px; position: absolute; color: black; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Trang chủ</div>
                <img style="width: 28px; height: 28px; left: 22px; top: 19px; position: absolute" src="img/icon-home.png" />
            </div>
            <div class="nav-link" id="nav-noti" style="width: 336px; height: 72px; left: 0px; top: 232px; position: absolute">
                <div style="width: 312px; height: 56px; left: 12px; top: 8px; position: absolute; border-radius: 10px"></div>
                <div style="left: 61px; top: 25px; position: absolute; color: black; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Thông báo</div>
                <img style="width: 30px; height: 30px; left: 22px; top: 21px; position: absolute" src="img/icon-notification.png" />
                <div style="width: 24px; height: 24px; left: 162px; top: 24px; position: absolute">
                    <div style="width: 24px; height: 24px; left: 0px; top: 0px; position: absolute; background: #7E56DA; border-radius: 5px"></div>
                    <div style="left: 7px; top: 2px; position: absolute; text-align: center; color: white; font-size: 16px; font-family: Arial; font-weight: 700; word-wrap: break-word">2</div>
                </div>
            </div>
            <div class="nav-link" id="nav-settings" style="width: 336px; height: 72px; left: 0px; top: 304px; position: absolute">
                <div style="width: 312px; height: 56px; left: 12px; top: 8px; position: absolute; border-radius: 10px"></div>
                <div style="left: 61px; top: 25px; position: absolute; color: black; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Cài đặt</div>
                <img style="width: 24px; height: 23.98px; left: 25px; top: 24px; position: absolute" src="img/icon-settings.png" />
            </div>
        </div>



        <!-- Header -->
        <div style="width: 1440px; height: 79px; left: 0px; top: 0px; position: fixed; z-index: 1;">
            <div style="width: 1440px; height: 79px; left: 0px; top: 0px; position: absolute; background: #7E56DA"></div>
            <img style="width: 45px; height: 45px; left: 1357px; top: 17px; position: absolute; border-radius: 50px" src="img/icon-user.png" />
            <div style="left: 87px; top: 18px; position: absolute; color: white; font-size: 28px; font-family: Arial; font-weight: 700; word-wrap: break-word">KPI Master</div>
            <div style="left: 1220px; top: 23px; position: absolute; color: white; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Nguyen-san</div>
            <div style="width: 361px; height: 40px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; left: 539px; top: 19px; position: absolute; background: white; border-radius: 10px; border: 1px #E1E2E9 solid; justify-content: space-between; align-items: flex-start; display: inline-flex">
                <div style="color: #000000; font-size: 16px; font-family: Arial; font-weight: 400; line-height: 24px; word-wrap: break-word; width: 100%">
                    <input type="text" placeholder="Tìm kiếm" >
                </div>
            <div style="width: 24px; height: 24px; position: relative">
                <img style="width: 20px; height: 20px; left: 2px; top: 2px; position: absolute;" src="img/icon-search.png"></div>
            </div>
            </div>
            <img style="width: 128px; height: 85px; left: -17px; top: -3px; position: fixed; z-index: 1;" src="img/logo-white.png" />
        </div>



        <!-- Options -->
        <div id="kpi-options" onclick="showKpiOptions(event)" style="width: 40px; height: 6.96px; left: 1310px; top: 133.96px; position: absolute; transform-origin: 0 0; cursor: pointer;">
          <div style="width: 6.96px; height: 6.96px; left: 0px; top: 0px; position: absolute; transform-origin: 0 0; background: black; border-radius: 9999px"></div>
          <div style="width: 6.96px; height: 6.96px; left: 11.93px; top: 0px; position: absolute; transform-origin: 0 0; background: black; border-radius: 9999px"></div>
          <div style="width: 6.96px; height: 6.96px; left: 23.86px; top: 0px; position: absolute; transform-origin: 0 0; background: black; border-radius: 9999px"></div>
        </div>



        <!-- KPI details -->
        <div style="width: 647.18px; height: 191px; left: 387px; top: 171px; position: absolute">
            <div style="width: 170.18px; height: 170.18px; left: 477px; top: 0px; position: absolute">
              <!-- <div style="width: 110.51px; height: 55.25px; left: 30.94px; top: 57.46px; position: absolute; text-align: center; color: #4285F4; font-size: 36px; font-family: Arial; font-weight: 500; word-wrap: break-word">70%</div>
              <div style="width: 170.18px; height: 170.18px; left: 0px; top: 0px; position: absolute; background: #D9D9D9; border-radius: 9999px"></div>
              <div style="width: 170.18px; height: 170.18px; left: 0px; top: 0px; position: absolute; background: #4285F4; border-radius: 9999px"></div> -->
              <svg width="170" height="170" viewBox="-21.25 -21.25 212.5 212.5" version="1.1" xmlns="http://www.w3.org/2000/svg" style="transform:rotate(-90deg)">
                <circle r="75" cx="85" cy="85" fill="transparent" stroke="#e0e0e0" stroke-width="20" stroke-dasharray="471px" stroke-dashoffset="0"></circle>
                <circle id="kpi-progress" r="75" cx="85" cy="85" stroke="#6586d2" stroke-width="20" stroke-linecap="round" stroke-dashoffset="99px" fill="transparent" stroke-dasharray="471px"></circle>
                <text id="kpi-percent" x="46px" y="99px" fill="#6586d2" font-size="42px" font-weight="bold" style="transform:rotate(90deg) translate(0px, -166px)">79%</text>
              </svg>
            </div>
            <div style="width: 237px; height: 25px; left: 0px; top: 124px; position: absolute"><span id="kpi-completed-tasks" style="color: black; font-size: 16px; font-family: Arial; font-weight: 600; word-wrap: break-word">42/60</span><span style="color: black; font-size: 16px; font-family: Arial; font-weight: 400; word-wrap: break-word"> công việc đã hoàn tất</span></div>
            <div id="kpi-description" style="width: 237px; height: 25px; left: 0px; top: 58px; position: absolute; color: black; font-size: 16px; font-family: Arial; font-weight: 400; word-wrap: break-word">Không có mô tả.</div>
            <div style="width: 249px; height: 25px; left: 0px; top: 92px; position: absolute">
              <div id="kpi-due" style="width: 229px; height: 25px; left: 20px; top: 0px; position: absolute; color: black; font-size: 14px; font-family: Arial; font-weight: 400; word-wrap: break-word">Hạn 31/05/2024</div>
              <img style="width: 14px; height: 14px; left: 0px; top: 5px; position: absolute" src="img/icon-date.png" />
            </div>
            <div class="button-primary" id="btn-report" style="width: 186px; height: 41px; padding-top: 10px; padding-bottom: 10px; padding-left: 24px; padding-right: 20px; left: 0px; top: 160px; position: absolute; border-radius: 10px; justify-content: center; align-items: center; gap: 8px; display: inline-flex">
              <div style="color: white; font-size: 18px; font-family: Arial; font-weight: 400; line-height: 27px; word-wrap: break-word">Xem báo cáo</div>
              <div style="width: 24px; height: 24px; position: relative">
                <img style="width: 24px; height: 24px; left: 4px; top: 0px; position: absolute;" src="img/icon-right-arrow.png">
              </div>
            </div>
            <div id="kpi-name" style="width: 400px; height: 25px; left: 0px; top: 5px; position: absolute; color: black; font-size: 32px; font-family: Arial; font-weight: 500; word-wrap: break-word">Giảng dạy</div>
          </div>



          
          <div style="width: 954px; height: 0px; left: 387px; top: 393px; position: absolute; border: 1px black solid"></div>
          <div style="width: 271px; height: 25px; left: 387px; top: 422px; position: absolute; color: black; font-size: 22px; font-family: Arial; font-weight: 500; word-wrap: break-word">Danh sách công việc</div>
          <img id="btn-back" style="width: 26px; height: 26px; left: 388px; top: 141px; position: absolute; cursor: pointer;" src="img/icon-back.png" />
          <div id="btn-filter" style="width: 73px; left: 652px; top: 424px; position: absolute; cursor: pointer;">
            <div style="width: 40px; height: 16px; left: 33px; top: 3px; position: absolute; color: black; font-size: 18px; font-family: Arial; font-weight: 400; word-wrap: break-word">Lọc</div>
            <div style="width: 22px; height: 22px; left: 0px; top: 3px; position: absolute; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: inline-flex">
              <img src="img/icon-filter.png" width="22px">
            </div>
          </div>
          


          <!-- Task table -->
          <div id="task-table" style="width: 954px; height: 369px; left: 387px; top: 499px; position: absolute">
            <div style="width: 954px; height: 0px; left: 0px; top: 43px; position: absolute; border: 1px rgba(0, 0, 0, 0.40) solid"></div>
            <div style="width: 849px; height: 25px; left: 105px; top: 0px; position: absolute">
              <div style="width: 160px; height: 25px; left: 0px; top: 0px; position: absolute; color: black; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Tên công việc</div>
              <div style="width: 160px; height: 25px; left: 237px; top: 0px; position: absolute; color: black; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Ngày</div>
              <div style="width: 160px; height: 25px; left: 689px; top: 0px; position: absolute; color: black; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Trạng thái</div>
              <div style="width: 94px; height: 25px; left: 350px; top: 0px; position: absolute; text-align: right; color: black; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Bắt đầu</div>
              <div style="width: 95px; height: 25px; left: 491px; top: 0px; position: absolute; text-align: right; color: black; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Kết thúc</div>
            </div> 
            <!-- <div style="width: 954px; height: 56px; left: 0px; top: 44px; position: absolute">
              <div style="width: 954px; height: 56px; left: 0px; top: 0px; position: absolute; background: #F9F5FF"></div>
              <div style="width: 73px; height: 25px; left: 618px; top: 16px; position: absolute; text-align: right; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">11:45</div>
              <div style="width: 73px; height: 25px; left: 476px; top: 16px; position: absolute; text-align: right; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">9:20</div>
              <div style="width: 160px; height: 25px; left: 105px; top: 16px; position: absolute; color: black; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Công việc 2</div>
              <div style="width: 160px; height: 25px; left: 342px; top: 16px; position: absolute; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">16/05</div>
              <div style="width: 20px; height: 20px; left: 31px; top: 18px; position: absolute; border-radius: 9999px; border: 1px black solid"></div>
              <div style="width: 100px; height: 25px; left: 794px; top: 16px; position: absolute">
                <div style="width: 100px; height: 24px; left: 0px; top: 1px; position: absolute; background: white; border-radius: 20px; border: 1px #603EBB solid"></div>
                <div style="width: 63.22px; height: 25px; left: 18.39px; top: 0px; position: absolute; text-align: center; color: #603EBB; font-size: 14px; font-family: Arial; font-weight: 400; word-wrap: break-word">Sắp tới</div>
              </div>
            </div> -->
            <!-- <div style="width: 863px; height: 25px; left: 31px; top: 116px; position: absolute">
              <div style="width: 160px; height: 25px; left: 74px; top: 0px; position: absolute; color: black; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Công việc 3</div>
              <div style="width: 160px; height: 25px; left: 311px; top: 0px; position: absolute; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">18/05</div>
              <div style="width: 20px; height: 20px; left: 0px; top: 2px; position: absolute; border-radius: 9999px; border: 1px black solid"></div>
              <div style="width: 100px; height: 25px; left: 763px; top: 0px; position: absolute">
                <div style="width: 100px; height: 24px; left: 0px; top: 1px; position: absolute; background: white; border-radius: 20px; border: 1px #603EBB solid"></div>
                <div style="width: 63.22px; height: 25px; left: 18.39px; top: 0px; position: absolute; text-align: center; color: #603EBB; font-size: 14px; font-family: Arial; font-weight: 400; word-wrap: break-word">Sắp tới</div>
              </div>
              <div style="width: 73px; height: 25px; left: 445px; top: 0px; position: absolute; text-align: right; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">15:05</div>
              <div style="width: 73px; height: 25px; left: 587px; top: 0px; position: absolute; text-align: right; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">17:30</div>
            </div>
            <div style="width: 954px; height: 56px; left: 0px; top: 158px; position: absolute">
              <div style="width: 954px; height: 56px; left: 0px; top: 0px; position: absolute; background: #F9F5FF"></div>
              <div style="width: 160px; height: 25px; left: 105px; top: 16px; position: absolute; color: black; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Công việc 4</div>
              <div style="width: 160px; height: 25px; left: 342px; top: 16px; position: absolute; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">19/05</div>
              <div style="width: 20px; height: 20px; left: 31px; top: 18px; position: absolute; border-radius: 9999px; border: 1px black solid"></div>
              <div style="width: 100px; height: 25px; left: 794px; top: 16px; position: absolute">
                <div style="width: 100px; height: 24px; left: 0px; top: 1px; position: absolute; background: white; border-radius: 20px; border: 1px #603EBB solid"></div>
                <div style="width: 63.22px; height: 25px; left: 18.39px; top: 0px; position: absolute; text-align: center; color: #603EBB; font-size: 14px; font-family: Arial; font-weight: 400; word-wrap: break-word">Sắp tới</div>
              </div>
              <div style="width: 73px; height: 25px; left: 476px; top: 16px; position: absolute; text-align: right; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">10:15</div>
              <div style="width: 73px; height: 25px; left: 618px; top: 16px; position: absolute; text-align: right; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">11:45</div>
            </div>
            <div style="width: 863px; height: 25px; left: 31px; top: 230px; position: absolute">
              <div style="width: 160px; height: 25px; left: 74px; top: 0px; position: absolute; color: #0A840A; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Công việc 5</div>
              <div style="width: 160px; height: 25px; left: 311px; top: 0px; position: absolute; color: #0A840A; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">11/05</div>
              <img style="width: 20px; height: 20px; left: 0px; top: 3px; position: absolute" src="img/icon-check-filled.png" />
              <div style="width: 100px; height: 25px; left: 763px; top: 0px; position: absolute">
                <div style="width: 100px; height: 24px; left: 0px; top: 1px; position: absolute; background: white; border-radius: 20px; border: 1px #0A840A solid"></div>
                <div style="width: 88.51px; height: 25px; left: 5.75px; top: 0px; position: absolute; text-align: center; color: #0A840A; font-size: 14px; font-family: Arial; font-weight: 400; word-wrap: break-word">Hoàn thành</div>
              </div>
              <div style="width: 73px; height: 25px; left: 445px; top: 0px; position: absolute; text-align: right; color: #0A840A; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">8:25</div>
              <div style="width: 73px; height: 25px; left: 587px; top: 0px; position: absolute; text-align: right; color: #0A840A; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">10:05</div>
            </div>
            <div style="width: 954px; height: 96px; left: 0px; top: 273px; position: absolute">
              <div style="width: 954px; height: 56px; left: 0px; top: 0px; position: absolute; background: #F9F5FF"></div>
              <div style="width: 160px; height: 25px; left: 105px; top: 15px; position: absolute; color: #0A840A; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Công việc 6</div>
              <div style="width: 160px; height: 25px; left: 342px; top: 15px; position: absolute; color: #0A840A; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">12/05</div>
              <img style="width: 20px; height: 20px; left: 31px; top: 18px; position: absolute" src="img/icon-check-filled.png" />
              <div style="width: 100px; height: 25px; left: 794px; top: 15px; position: absolute">
                <div style="width: 100px; height: 24px; left: 0px; top: 1px; position: absolute; background: white; border-radius: 20px; border: 1px #0A840A solid"></div>
                <div style="width: 88.51px; height: 25px; left: 5.75px; top: 0px; position: absolute; text-align: center; color: #0A840A; font-size: 14px; font-family: Arial; font-weight: 400; word-wrap: break-word">Hoàn thành</div>
              </div>
              <div style="width: 73px; height: 25px; left: 476px; top: 15px; position: absolute; text-align: right; color: #0A840A; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">9:20</div>
              <div style="width: 73px; height: 25px; left: 476px; top: 71px; position: absolute; text-align: right; color: #D90000; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">14:10</div>
            </div>
            <div style="width: 863px; height: 25px; left: 31px; top: 344px; position: absolute">
              <div style="width: 160px; height: 25px; left: 74px; top: 0px; position: absolute; color: #D90000; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Công việc 1</div>
              <div style="width: 160px; height: 25px; left: 311px; top: 0px; position: absolute; color: #D90000; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">12/05</div>
              <div style="width: 20px; height: 20px; left: 0px; top: 2px; position: absolute; border-radius: 9999px; border: 1px black solid"></div>
              <div style="width: 100px; height: 25px; left: 763px; top: 0px; position: absolute">
                <div style="width: 100px; height: 24px; left: 0px; top: 1px; position: absolute; background: white; border-radius: 20px; border: 1px #D90000 solid"></div>
                <div style="width: 72.41px; height: 25px; left: 13.79px; top: 0px; position: absolute; text-align: center; color: #D90000; font-size: 14px; font-family: Arial; font-weight: 400; word-wrap: break-word">Quá hạn</div>
              </div>
            </div> -->
            <!-- <div style="width: 73px; height: 25px; left: 618px; top: 288px; position: absolute; text-align: right; color: #0A840A; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">11:45</div>
            <div style="width: 73px; height: 25px; left: 618px; top: 344px; position: absolute; text-align: right; color: #D90000; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">15:50</div> -->
          </div> 
          <div class="button-primary" id="btn-add-task" style="width: 177px; height: 40px; padding-top: 8px; padding-bottom: 8px; padding-left: 6px; padding-right: 20px; left: 1164px; top: 415px; position: absolute; border-radius: 10px; justify-content: center; align-items: center; gap: 3px; display: inline-flex">
            <img style="width: 29px; height: 28px" src="img/icon-plus.png" />
            <div style="color: white; font-size: 16px; font-family: Arial; font-weight: 400; line-height: 24px; word-wrap: break-word">Thêm công việc</div>
          </div>
        </div>

        <div class="modal-backdrop"></div>

        <!-- Add task modal -->
        <div class="modal" id="modal-add-task" style="width: 753px; height: 780px; left: 343px; top: 128px; position: fixed; background: white; box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.5); border-radius: 15px; overflow: hidden;">
          <div style="align-self: stretch; height: 64px; padding-top: 19px; padding-bottom: 20px; padding-left: 53px; padding-right: 464px; background: #F9F5FF; justify-content: flex-start; align-items: flex-start; gap: 244px; display: inline-flex">
            <div id="task-modal-name" style="width: 375px; height: 25px; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">Thêm công việc</div>
            <div class="btn-close" style="width: 24px; height: 24px; position: relative; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: flex; cursor: pointer;">
              <!-- <div style="width: 33.94px; height: 0px; transform: rotate(45deg); transform-origin: 0 0; border: 2px #5E5E5E solid"></div>
              <div style="width: 33.94px; height: 0px; transform: rotate(-45deg); transform-origin: 0 0; border: 2px #5E5E5E solid"></div> -->
            </div>
          </div>
          <div style="width: 753px; height: 804px; position: relative; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: flex">
            <div id="task-modal-title" style="position: absolute; top: 69px; left: 230px; width: 307px; height: 35px; text-align: center; color: black; font-size: 28px; font-family: Arial; font-weight: 500; word-wrap: break-word">
              Thêm công việc
            </div>
            <div style="position: absolute; top: 160px; left: 151px; width: 465px; height: 51px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; background: white; border-radius: 10px; border: 1px #7E56DA solid; justify-content: flex-start; align-items: center; gap: 12px; display: inline-flex">
              <div style="color: #8D8F9F; font-size: 20px; font-family: Arial; font-weight: 400; line-height: 30px; word-wrap: break-word; width: 100%;">
                <input id="task-name" type="text" placeholder="Tên công việc *">
              </div>
            </div>
            <div style="position: absolute; top: 227px; left: 151px; width: 465px; height: 51px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; background: white; border-radius: 10px; border: 1px #7E56DA solid; justify-content: flex-start; align-items: center; gap: 12px; display: inline-flex">
              <!-- <div style="justify-content: flex-start; align-items: center; gap: 8px; display: flex"> -->
                <img style="width: 25px; height: 25px" src="img/icon-date-faded.png" />
                <div style="color: #8D8F9F; font-size: 20px; font-family: Arial; font-weight: 400; line-height: 30px; word-wrap: break-word; width: 100%">
                  <input id="task-date" type="text" placeholder="Ngày *">
                </div>
              <!-- </div> -->
            </div>
            <div style="position: absolute; top: 294px; left: 151px; width: 226px; height: 51px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; background: white; border-radius: 10px; border: 1px #7E56DA solid; justify-content: flex-start; align-items: center; gap: 12px; display: inline-flex">
              <!-- <div style="justify-content: flex-start; align-items: center; gap: 8px; display: flex"> -->
                <img style="width: 25px; height: 27px" src="img/icon-clock-faded.png" />
                <div style="color: #8D8F9F; font-size: 20px; font-family: Arial; font-weight: 400; line-height: 30px; word-wrap: break-word">
                  <input id="task-start" type="text" placeholder="Bắt đầu *">
                </div>
              <!-- </div> -->
            </div>
            <div style="position: absolute; top: 294px; left: 390px; width: 226px; height: 51px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; background: white; border-radius: 10px; border: 1px #7E56DA solid; justify-content: flex-start; align-items: center; gap: 12px; display: inline-flex">
              <!-- <div style="justify-content: flex-start; align-items: center; gap: 8px; display: flex"> -->
                <img style="width: 25px; height: 27px" src="img/icon-clock-faded.png" />
                <div style="color: #8D8F9F; font-size: 20px; font-family: Arial; font-weight: 400; line-height: 30px; word-wrap: break-word">
                  <input id="task-end" type="text" placeholder="Kết thúc *">
                </div>
              <!-- </div> -->
            </div>
            <div style="position: absolute; top: 361px; left: 151px; width: 465px; height: 51px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; background: white; border-radius: 10px; border: 1px #7E56DA solid; justify-content: flex-start; align-items: center; gap: 12px; display: inline-flex">
              <!-- <div style="justify-content: flex-start; align-items: center; gap: 8px; display: flex"> -->
                <img style="width: 25px; height: 25px" src="img/icon-repeat-faded.png" />
                <div style="color: #8D8F9F; font-size: 20px; font-family: Arial; font-weight: 400; line-height: 30px; word-wrap: break-word">
                  <select id="task-repeat" style="width: 380px; color: #8D8F9F;">

                  </select>
                </div>
              <!-- </div> -->
            </div>
            <div style="position: absolute; top: 428px; left: 151px; width: 465px; height: 51px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; background: white; border-radius: 10px; border: 1px #7E56DA solid; justify-content: flex-start; align-items: center; gap: 12px; display: inline-flex">
              <!-- <div style="width: 469px; height: 37px; justify-content: flex-start; align-items: center; gap: 8px; display: flex"> -->
                <img style="width: 25px; height: 25px" src="img/icon-notification-faded.png" />
                <div style="color: #8D8F9F; font-size: 20px; font-family: Arial; font-weight: 400; line-height: 30px; word-wrap: break-word">
                  <select id="task-noti" style="width: 380px; color: #8D8F9F;">
                    
                  </select>
                </div>
              <!-- </div> -->
            </div>
            <div class="button-primary" id="btn-save-task" style="position: absolute; top: 562px; left: 151px; width: 465px; height: 50px; padding-left: 24px; padding-right: 24px; padding-top: 8px; padding-bottom: 8px; border-radius: 10px; justify-content: center; align-items: center; gap: 8px; display: inline-flex">
              <div style="color: white; font-size: 24px; font-family: Arial; font-weight: 600; line-height: 36px; word-wrap: break-word">Lưu</div>
            </div>
          </div>
        </div>


        <!-- Edit KPI modal -->
        <div class="modal" id="modal-edit-kpi" style="width: 753px; height: 780px; left: 343px; top: 128px; position: fixed; background: white; box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.5); border-radius: 15px; overflow: hidden;">
          <div style="align-self: stretch; height: 64px; padding-top: 19px; padding-bottom: 20px; padding-left: 53px; padding-right: 464px; background: #F9F5FF; justify-content: flex-start; align-items: flex-start; gap: 244px; display: inline-flex">
            <div style="width: 375px; height: 25px; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">Chỉnh sửa KPI</div>
            <div class="btn-close" style="width: 24px; height: 24px; position: relative; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: flex; cursor: pointer;">
              <!-- <div style="width: 33.94px; height: 0px; transform: rotate(45deg); transform-origin: 0 0; border: 2px #5E5E5E solid"></div>
              <div style="width: 33.94px; height: 0px; transform: rotate(-45deg); transform-origin: 0 0; border: 2px #5E5E5E solid"></div> -->
            </div>
          </div>
          <div style="width: 753px; height: 804px; position: relative; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: flex">
            <div style="position: absolute; top: 69px; left: 230px; width: 307px; height: 35px; text-align: center; color: black; font-size: 28px; font-family: Arial; font-weight: 500; word-wrap: break-word">
              Chỉnh sửa KPI
            </div>
            <div style="position: absolute; top: 160px; left: 151px; width: 465px; height: 51px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; background: white; border-radius: 10px; border: 1px #7E56DA solid; justify-content: flex-start; align-items: center; gap: 12px; display: inline-flex">
              <div style="color: #8D8F9F; font-size: 20px; font-family: Arial; font-weight: 400; line-height: 30px; word-wrap: break-word; width: 100%;">
                <input id="inp-kpi-name" type="text" placeholder="Tên KPI *">
              </div>
            </div>
            <div style="position: absolute; top: 227px; left: 151px; width: 465px; height: 51px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; background: white; border-radius: 10px; border: 1px #7E56DA solid; justify-content: flex-start; align-items: center; gap: 12px; display: inline-flex">
              <div style="color: #8D8F9F; font-size: 20px; font-family: Arial; font-weight: 400; line-height: 30px; word-wrap: break-word; width: 100%;">
                <input id="inp-kpi-description" type="text" placeholder="Mô tả">
              </div>
            </div>
            <div style="position: absolute; top: 294px; left: 151px; width: 465px; height: 51px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; background: white; border-radius: 10px; border: 1px #7E56DA solid; justify-content: flex-start; align-items: center; gap: 12px; display: inline-flex">
              <!-- <div style="justify-content: flex-start; align-items: center; gap: 8px; display: flex"> -->
                <img style="width: 25px; height: 25px" src="img/icon-date-faded.png" />
                <div style="color: #8D8F9F; font-size: 20px; font-family: Arial; font-weight: 400; line-height: 30px; word-wrap: break-word; width: 100%">
                  <input id="inp-kpi-due" type="text" placeholder="Thời hạn *">
                </div>
              <!-- </div> -->
            </div>
            <div style="position: absolute; top: 361px; left: 151px; width: 465px; height: 51px; padding-left: 16px; padding-right: 16px; padding-top: 8px; padding-bottom: 8px; background: white; border-radius: 10px; border: 1px #7E56DA solid; justify-content: flex-start; align-items: center; gap: 12px; display: inline-flex">
              <!-- <div style="justify-content: flex-start; align-items: center; gap: 8px; display: flex"> -->
                <img style="width: 25px; height: 25px" src="img/icon-repeat-faded.png" />
                <div style="color: #8D8F9F; font-size: 20px; font-family: Arial; font-weight: 400; line-height: 30px; word-wrap: break-word">
                  <select id="inp-kpi-repeat" style="width: 380px; color: #8D8F9F;">

                  </select>
                </div>
              <!-- </div> -->
            </div>
            <div class="button-primary" id="btn-save-kpi" style="position: absolute; top: 500px; left: 151px; width: 465px; height: 50px; padding-left: 24px; padding-right: 24px; padding-top: 8px; padding-bottom: 8px; border-radius: 10px; justify-content: center; align-items: center; gap: 8px; display: inline-flex">
              <div style="color: white; font-size: 24px; font-family: Arial; font-weight: 600; line-height: 36px; word-wrap: break-word">Lưu</div>
            </div>
          </div>
        </div>


        <div id="task-menu" class="dropdown-menu dropdown-menu-end" aria-labelledby="menuButton" style="display: none; z-index: 2; position: fixed;">
          <a onclick="openModalEditTask(event)" class="dropdown-item" style="cursor: pointer;">Chỉnh sửa công việc</a>
          <a onclick="confirmDeleteTask(event)" class="dropdown-item" style="cursor: pointer;">Xóa công việc</a>
        </div>

        <div id="kpi-menu" class="dropdown-menu dropdown-menu-end" aria-labelledby="menuButton" style="display: none; z-index: 2; position: fixed;">
          <a onclick="openModalEditKpi(event)" class="dropdown-item" style="cursor: pointer;">Chỉnh sửa KPI</a>
          <a onclick="confirmDeleteKpi(event)" class="dropdown-item" style="cursor: pointer;">Xóa KPI</a>
        </div>

        <div id="filter-menu" class="dropdown-menu dropdown-menu-end" aria-labelledby="menuButton" style="display: none; z-index: 2; position: fixed;">
          <a onclick="removeFilter()" class="dropdown-item" style="cursor: pointer;">Tất cả</a>
          <a onclick="filterUpcomingTasks()" class="dropdown-item" style="cursor: pointer;">Sắp tới</a>
          <a onclick="filterCompletedTasks()" class="dropdown-item" style="cursor: pointer;">Đã hoàn thành</a>
          <a onclick="filterPastDueTasks()" class="dropdown-item" style="cursor: pointer;">Quá hạn</a>
        </div>


        <!-- KPI Report -->
        <dialog id="report-dialog" style="width: 755px; height: 828px; position: fixed; top: 100px; left: 245px; background: white; box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.5); border-radius: 15px; overflow: hidden;">
          <div style="height: 64px; padding-top: 20px; padding-bottom: 19px; padding-left: 51px; padding-right: 36px; left: 0px; top: 0px; position: absolute; background: #F9F5FF; border-bottom: 1px #D9D9D9 solid; justify-content: flex-end; align-items: flex-start; gap: 264px; display: inline-flex">
            <div style="width: 375px; height: 25px; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">Báo cáo KPI</div>
            <div class="btn-close" style="width: 24px; height: 24px; position: relative; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: flex; cursor: pointer;">
            </div>
          </div>
          <div style="width: 750px; height: 764px; left: 0px; top: 64px; position: absolute; overflow: scroll">
            <div style="width: 613px; height: 279px; left: 54px; top: 572px; position: absolute">
              <div style="width: 189px; height: 17px; left: 0px; top: 0px; position: absolute; color: black; font-size: 18px; font-family: Arial; font-weight: 600; word-wrap: break-word">Biểu đồ tổng quan</div>
              <div style="width: 221px; height: 91px; left: 392px; top: 115px; position: absolute">
                <div style="width: 22px; height: 22px; left: 0px; top: 0px; position: absolute; background: #0A22FF; border-radius: 9999px; border: 1px solid"></div>
                <div style="width: 22px; height: 22px; left: 0px; top: 36px; position: absolute; background: #EABB19; border-radius: 9999px; border: 1px solid"></div>
                <div style="width: 22px; height: 22px; left: 0px; top: 69px; position: absolute; background: #5DCC61; border-radius: 9999px; border: 1px solid"></div>
                <div style="width: 193px; height: 16px; left: 28px; top: 3px; position: absolute; color: black; font-size: 16px; font-family: Arial; font-weight: 400; word-wrap: break-word">Công việc cần làm (17)</div>
                <div style="width: 183px; height: 16px; left: 28px; top: 39px; position: absolute; color: black; font-size: 16px; font-family: Arial; font-weight: 400; word-wrap: break-word">Công việc quá hạn (1)</div>
                <div style="width: 163px; height: 16px; left: 28px; top: 72px; position: absolute; color: black; font-size: 16px; font-family: Arial; font-weight: 400; word-wrap: break-word">Đã hoàn thành (42)</div>
              </div>
              <div style="width: 60px; left: 31px; top: 98px; position: absolute; text-align: center; color: #0569FF; font-size: 14px; font-family: Arial; font-weight: 700; word-wrap: break-word">107/153</div>
              <img style="width: 236px; height: 243px; left: 0px; top: 36px; position: absolute" src="img/img-donut-chart.png" />
              <div style="width: 128px; height: 29px; left: 53px; top: 124px; position: absolute; text-align: center; color: black; font-size: 20px; font-family: Arial; font-weight: 600; word-wrap: break-word">60 <br/>công việc</div>
            </div>
            <div style="width: 620px; height: 194px; left: 54px; top: 365px; position: absolute">
              <div style="width: 263.25px; height: 29.66px; left: 0px; top: 0px; position: absolute; color: black; font-size: 18px; font-family: Arial; font-weight: 600; word-wrap: break-word">Báo cáo tiến triển</div>
              <div style="width: 335.55px; height: 29.66px; left: 0px; top: 48px; position: absolute; color: black; font-size: 16px; font-family: Arial; font-weight: 400; word-wrap: break-word">Mục tiêu: Hoàn thành xuất sắc</div>
              <div style="width: 129.77px; height: 29.66px; left: 59px; top: 90px; position: absolute; color: black; font-size: 16px; font-family: Arial; font-weight: 400; word-wrap: break-word">công việc</div>
              <div style="width: 328px; height: 30px; left: 0px; top: 132px; position: absolute; color: black; font-size: 16px; font-family: Arial; font-weight: 400; word-wrap: break-word">Bạn đang có tiến độ tốt! Tiếp tục đi lên!</div>
              <div style="width: 111.23px; height: 31.52px; left: 0px; top: 89px; position: absolute; color: #0569FF; font-size: 16px; font-family: Arial; font-weight: 700; word-wrap: break-word">42/60</div>
              <img style="width: 219px; height: 194px; left: 401px; top: 0px; position: absolute" src="img/img-progress-ring-large.png" />
            </div>
            <div style="width: 621.20px; height: 234px; left: 42px; top: 93px; position: absolute">
              <div style="width: 322.59px; height: 29.83px; left: 10px; top: 0px; position: absolute; color: black; font-size: 18px; font-family: Arial; font-weight: 600; word-wrap: break-word">Tổng quan công việc</div>
              <div style="width: 195.79px; height: 171.32px; left: 0px; top: 62.68px; position: absolute">
                <div style="width: 72.72px; height: 42.89px; left: 62px; top: 31.32px; position: absolute; text-align: center; color: #0A22FF; font-size: 36px; font-family: Arial; font-weight: 700; word-wrap: break-word">17</div>
                <div style="width: 195.79px; height: 39.16px; left: 0px; top: 93px; position: absolute; text-align: center; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">Công việc<br/>cần làm</div>
                <div style="width: 171.32px; height: 171.32px; left: 12.24px; top: 0px; position: absolute; border-radius: 10px; border: 1px rgba(0, 0, 0, 0.50) solid"></div>
              </div>
              <div style="width: 196.06px; height: 171.55px; left: 425.14px; top: 62.45px; position: absolute">
                <div style="width: 49.01px; height: 41.66px; left: 72.86px; top: 31.55px; position: absolute; text-align: center; color: #FF0000; font-size: 36px; font-family: Arial; font-weight: 700; word-wrap: break-word">1</div>
                <div style="width: 196.06px; height: 39.21px; left: 0px; top: 90.02px; position: absolute; text-align: center; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">Công việc<br/>quá hạn</div>
                <div style="width: 171.55px; height: 171.55px; left: 12.25px; top: 0px; position: absolute; border-radius: 10px; border: 1px rgba(0, 0, 0, 0.50) solid"></div>
              </div>
              <div style="width: 196.06px; height: 171.55px; left: 210.71px; top: 62.45px; position: absolute">
                <div style="width: 80.18px; height: 41.02px; left: 58.29px; top: 32.55px; position: absolute; text-align: center; color: #5DCC61; font-size: 36px; font-family: Arial; font-weight: 700; word-wrap: break-word">42</div>
                <div style="width: 196.06px; height: 39.21px; left: 0px; top: 93.23px; position: absolute; text-align: center; color: black; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">Đã hoàn<br/>thành</div>
                <div style="width: 171.55px; height: 171.55px; left: 12.25px; top: 0px; position: absolute; border-radius: 10px; border: 1px rgba(0, 0, 0, 0.50) solid"></div>
              </div>
            </div>
            <div style="width: 632px; height: 0px; left: 52px; top: 74px; position: absolute; border: 1px black solid"></div>
            <div style="width: 326px; height: 35px; left: 52px; top: 26px; position: absolute; color: black; font-size: 24px; font-family: Arial; font-weight: 500; word-wrap: break-word">Giảng dạy</div>
          </div>
        </dialog>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="data.js"></script>
  <script src="common.js"></script>
  <script>


    // Load KPI data
    let kpi;

    function renderKpiDetails() {
      $("#btn-back").click(() => window.location.href = 'kpi.html');
        
      $("#kpi-name").text(kpi.name);
      $("#kpi-description").text(kpi.description || 'Không có mô tả');
      $("#kpi-due").text(`Hạn ${kpi.due.getDate()}/${kpi.due.getMonth()+1}/${kpi.due.getFullYear()}`);
      $("#kpi-completed-tasks").text(`${getNumberOfFinishedTasks(kpi)}/${kpi.tasks.length}`);

      const percentage = getCompletedPercentage(kpi);
      const strokeDasharray = +$("#kpi-progress").css("stroke-dasharray").slice(0, -2);
      const strokeDashoffset = (100-percentage)/100 * strokeDasharray;
      $("#kpi-progress").css("stroke-dashoffset", strokeDashoffset);
      console.log(strokeDashoffset);
      $("#kpi-percent").text(`${Math.round(percentage)}%`);
    }

    function renderTasks(tasks) {
      const statusColorMap = ['#603EBB', '#0A840A', '#D90000'];

      $("#task-table").empty();
      $("#task-table").append(`<div style="width: 954px; height: 0px; left: 0px; top: 43px; position: absolute; border: 1px rgba(0, 0, 0, 0.40) solid"></div>
            <div style="width: 849px; height: 25px; left: 105px; top: 0px; position: absolute">
              <div style="width: 160px; height: 25px; left: 0px; top: 0px; position: absolute; color: black; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Tên công việc</div>
              <div style="width: 160px; height: 25px; left: 237px; top: 0px; position: absolute; color: black; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Ngày</div>
              <div style="width: 160px; height: 25px; left: 689px; top: 0px; position: absolute; color: black; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Trạng thái</div>
              <div style="width: 94px; height: 25px; left: 350px; top: 0px; position: absolute; text-align: right; color: black; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Bắt đầu</div>
              <div style="width: 95px; height: 25px; left: 491px; top: 0px; position: absolute; text-align: right; color: black; font-size: 20px; font-family: Arial; font-weight: 500; word-wrap: break-word">Kết thúc</div>
            </div> `);
      let y = 44;
        tasks.forEach((task,i) => {
            const row = $(`<div id="task-${i}" style="width: 954px; height: 56px; left: 0px; top: ${y}px; position: absolute">
              <div style="width: 954px; height: 56px; left: 0px; top: 0px; position: absolute; background: #${y % 2 == 0 ? 'F9F5FF' : 'FFFFFF'}"></div>
              <div style="width: 73px; height: 25px; left: 618px; top: 16px; position: absolute; text-align: right; color: ${statusColorMap[task.status]} ; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">${task.end}</div>
              <div style="width: 73px; height: 25px; left: 476px; top: 16px; position: absolute; text-align: right; color: ${statusColorMap[task.status]} ; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">${task.start}</div>
              <div style="width: 160px; height: 25px; left: 105px; top: 16px; position: absolute; color: ${statusColorMap[task.status]} ; font-size: 20px; font-family: Arial; font-weight: 500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap" title="${task.name}">${task.name}</div>
              <div style="width: 160px; height: 25px; left: 342px; top: 16px; position: absolute; color: ${statusColorMap[task.status]} ; font-size: 20px; font-family: Arial; font-weight: 400; word-wrap: break-word">${task.date.getDate()}/${task.date.getMonth()+1}</div>
              ${task.status === 1 ? `<img class="task-check" onclick="toggleTaskStatus(event)" src="img/icon-check-filled.png" style="width: 20px; left: 31px; top: 18px; position: absolute;">` : `<div class="task-check" style="width: 20px; height: 20px; left: 31px; top: 18px; position: absolute; " onclick="toggleTaskStatus(event)"></div>`}
              <div style="width: 100px; height: 25px; left: 794px; top: 16px; position: absolute">
                <div style="width: 100px; height: 24px; left: 0px; top: 0px; position: absolute; background: white; border-radius: 20px; border: 1px ${statusColorMap[task.status]} solid"></div>
                <div style="width: 100px; height: 25px; left: 0px; top: 0px; position: absolute; text-align: center; color: ${statusColorMap[task.status]}; font-size: 14px; font-family: Arial; font-weight: 400; word-wrap: break-word">${statusValues[task.status]}</div>
              </div>
              <div class="task-options" onclick="showTaskOptions(event)" style="width: 40px; height: 4px; left: 910px; top: 26px; position: absolute; transform-origin: 0 0; cursor: pointer;">
                <div style="width: 5px; height: 5px; left: 0px; top: 0px; position: absolute; transform-origin: 0 0; background: black; border-radius: 9999px"></div>
                <div style="width: 5px; height: 5px; left: 7px; top: 0px; position: absolute; transform-origin: 0 0; background: black; border-radius: 9999px"></div>
                <div style="width: 5px; height: 5px; left: 14px; top: 0px; position: absolute; transform-origin: 0 0; background: black; border-radius: 9999px"></div>
              </div>
            </div>`);
            $("#task-table").append(row);
            y += 57;
        });
    }

    function renderInformation() {
      renderKpiDetails();
      renderTasks(kpi.tasks);
    }

    const urlParams = new URLSearchParams(window.location.search);
    const id = +urlParams.get('id');
    if (id) {
        console.log(id);
        kpi = findKpiById(id);
        console.log(kpi);

        renderInformation();
    }

    function toggleTaskStatus(event) {
      console.log(event.target);
      const i = +$(event.target.parentNode).attr("id").slice('task-'.length);
      console.log(i);
      const task = kpi.tasks[i];
      if (task.status === 0 || task.status === 2)
        task.status = 1;
      else 
        task.status = task.date < new Date() ? 2 : 0;
      console.log(kpi.tasks[i]);
      renderInformation();
    }


    // Task options menu
    function showTaskOptions(event) {
      console.log(event.target);
      const id = $(event.target.parentNode).attr("id") ?? $(event.target.parentNode.parentNode).attr("id");
      const i = +id.slice('task-'.length);
      console.log(i);
      $("#task-menu").attr("task-index", `${i}`);
      $("#task-menu").css("top", `${event.clientY}px`);
      $("#task-menu").css("left", `${event.clientX}px`);
      $("#task-menu").show();
      $(".task-options").off('click', showTaskOptions);
      setTimeout(()=> $(document).click(hideTaskMenu), 100);
    }

    const menu = $("#task-menu");
    const triggerButton = $(".task-options");


    function hideTaskMenu(event) {
          console.log('Hiding menu');
          menu.hide(); // Hide the menu
          $(document).off('click', hideTaskMenu);
          setTimeout(()=> $(".task-options").click(showTaskOptions), 100);
      }
    

    function confirmDeleteTask(event) {
      const i = +$(event.target.parentNode).attr("task-index");
      console.log(i);
      const task = kpi.tasks[i];

      if (window.confirm("Bạn có chắc muốn xóa công việc '" + task.name + "' ?")) {
        kpi.tasks.splice(i,1);
        console.log(kpi.tasks);
        renderInformation();
      }
    }


    // KPI options menu
    function showKpiOptions(event) {
      console.log(event.target);
      $("#kpi-menu").css("top", `${event.clientY}px`);
      $("#kpi-menu").css("left", `${event.clientX}px`);
      $("#kpi-menu").show();
      $("#kpi-options").off('click', showKpiOptions);
      setTimeout(()=> $(document).click(hideKpiMenu), 100);
    }


    function hideKpiMenu(event) {
          const menu = $("#kpi-menu");
          console.log('Hiding menu');
          menu.hide(); // Hide the menu
          $(document).off('click', hideKpiMenu);
          setTimeout(()=> $("#kpi-options").click(showKpiOptions), 100);
      }
    

    function confirmDeleteKpi(event) {
      if (window.confirm("Bạn có chắc muốn xóa KPI này?")) {
        window.location.href = 'kpi.html';
      }
    }


    // Handle modals;
    function closeModal() {
        $(".modal-backdrop").css("display", "none");
        $(".modal").css("display", "none");
    }

    function openModalAddTask() {
        closeModal();
        $(".modal-backdrop").css("display", "block");
        $("#modal-add-task").css("display", "block");
        $("#btn-save-task").off('click', saveTask);
        $("#btn-save-task").click(addNewTask);
    }

    function openModalEditTask(event) {
        const i = +$(event.target.parentNode).attr("task-index");
        console.log(i);
        const task = kpi.tasks[i];
        closeModal();
        $(".modal-backdrop").css("display", "block");
        $("#modal-add-task").css("display", "block");
        $("#modal-add-task").attr("task-index", i);
        $("#task-modal-title, #task-modal-name").text("Chỉnh sửa công việc");
        $("#task-name").val(task.name);
        $("#task-date").val(`${task.date.getFullYear()}-${task.date.getMonth()+1<10?'0':''}${task.date.getMonth()+1}-${task.date.getDate()}`);
        $("#task-start").val(`${task.start}`);
        $("#task-end").val(`${task.end}`);
        $("#task-repeat").val(""+task.repeat);
        $("#task-noti").val(""+task.noti);
        $("#btn-save-task").attr("disabled", false);
        $("#btn-save-task").off('click', addNewTask);
        $("#btn-save-task").click(saveTask);
    }

    $("#btn-add-task").click(openModalAddTask);
    $(".btn-close").click(closeModal);

    // Handle add new task
    $("#task-date,#inp-kpi-due").focus((event) => $(event.target).attr("type", "date"));
    $("#task-date,#inp-kpi-due").blur((event) => $(event.target).attr("type", "text"));
    $("#task-start,#task-end").focus((event) =>$(event.target).attr("type", "time"));
    $("#task-start,#task-end").blur(() => $(event.target).attr("type", "text"));
    $("#task-repeat,#inp-kpi-repeat").append(repeatTypes.map((r,i) => $(`<option value="${i}" ${i===0?'selected':''}>${r}</option>`)));
    $("#task-noti").append(notiTypes.map((n,i) => $(`<option value="${i}" ${i===1?'selected':''}>${n}</option>`)));

    $("#btn-save-task").attr("disabled", true);
    $("#btn-save-task").off('click');
    $("#btn-save-task").attr("title", "Vui lòng điền các mục bắt buộc");

    function validateTask() {
        const name = $("#task-name").val().trim();
        const date = new Date($("#task-date").val());
        const start = $("#task-start").val();
        const end = $("#task-end").val()
        console.log(name,date,start,end);
        if (name.length > 0 && date != 'Invalid Date' && start && end) {
            $("#btn-save-task").attr("disabled", false);
            $("#btn-save-task").click($("#task-modal-title").text().startsWith("Chỉnh") ? saveTask : addNewTask);
            $("#btn-save-task").removeAttr("title");
        } else {
            if (name.length === 0) {
                $("#btn-save-task").attr("disabled", true);
                $("#btn-save-task").off('click');
                $("#btn-save-task").attr("title", "Vui lòng điền tên công việc");
            } else if (date == 'Invalid Date') {
                $("#btn-save-task").attr("disabled", true);
                $("#btn-save-task").off('click');
                $("#btn-save-task").attr("title", "Vui lòng chọn ngày");
            } else if (!start) {
                $("#btn-save-task").attr("disabled", true);
                $("#btn-save-task").off('click');
                $("#btn-save-task").attr("title", "Vui lòng chọn thời gian bắt đầu");
            } else if (!end) {
                $("#btn-save-task").attr("disabled", true);
                $("#btn-save-task").off('click');
                $("#btn-save-task").attr("title", "Vui lòng chọn thời gian kết thúc");
            }
        }
    }

    $("#task-name").keydown(validateTask);
    $("#task-date,#task-start,#task-end").change(validateTask);

    function addNewTask() {
        console.log("add new task");
        let task = {
            id: getNextTaskId(kpi),
            name: $("#task-name").val(),
            date: new Date($("#task-date").val()),
            start: $("#task-start").val(),
            end: $("#task-end").val(),
            repeat: $("#task-repeat").val(),
            noti: $("#task-noti").val(),
            status: new Date($("#task-date").val()) < new Date() ? 2 : 0
        }; 
        kpi.tasks.push(task);
        sortTasks(kpi);
        console.log(kpi.tasks);
        closeModal();
        renderInformation();
    }

    function saveTask() {
      let i = +$("#modal-add-task").attr("task-index");
      let task = {
            id: getNextTaskId(kpi),
            name: $("#task-name").val(),
            date: new Date($("#task-date").val()),
            start: $("#task-start").val(),
            end: $("#task-end").val(),
            repeat: $("#task-repeat").val(),
            noti: $("#task-noti").val(),
            status: kpi.tasks[i].status === 1 ? 1 : new Date($("#task-date").val()) < new Date() ? 2 : 0
      }; 
      kpi.tasks.splice(i,1,task);
      sortTasks(kpi);
      console.log(kpi.tasks);
      closeModal();
      renderInformation();
    }

    // Handle edit KPI
    function openModalEditKpi(event) {
        console.log(kpi);
        closeModal();
        $(".modal-backdrop").css("display", "block");
        $("#modal-edit-kpi").css("display", "block");
        $("#inp-kpi-name").val(kpi.name);
        $("#inp-kpi-due").val(`${kpi.due.getFullYear()}-${kpi.due.getMonth()+1<10?'0':''}${kpi.due.getMonth()+1}-${kpi.due.getDate()}`);
        $("#inp-kpi-description").val(`${kpi.description}`);
        $("#inp-kpi-repeat").val(""+kpi.repeat);
        $("#btn-save-kpi").attr("disabled", false);
        $("#btn-save-kpi").click(updateKpi);
    }

    function validateKpi() {
        const name = $("#inp-kpi-name").val().trim();
        const due = new Date($("#inp-kpi-due").val());
        if (name.length > 0 && due != 'Invalid Date') {
            $("#btn-save-kpi").attr("disabled", false);
            $("#btn-save-kpi").click(updateKpi);
        } else {
            if (name.length === 0) {
                $("#btn-save-kpi").attr("disabled", true);
                $("#btn-save-kpi").off('click');
                $("#btn-save-kpi").attr("title", "Vui lòng điền tên KPI");
            } else {
                $("#btn-save-kpi").attr("disabled", true);
                $("#btn-save-kpi").off('click');
                $("#btn-save-kpi").attr("title", "Vui lòng chọn thời hạn");
            }
        }
    }

    $("#inp-kpi-name").keydown(validateKpi);
    $("#inp-kpi-due").change(validateKpi);

    function updateKpi() {
        kpi = {
            name: $("#inp-kpi-name").val(),
            description: $("#inp-kpi-description").val(),
            due: new Date($("#inp-kpi-due").val()),
            repeat: +$("#inp-kpi-repeat").val(),
            tasks: kpi.tasks
        };
        console.log(kpi);
        closeModal();
        renderInformation();
    }


    // KPI report
    const reportDialog = document.getElementById("report-dialog");
    $("#btn-report").click(() => reportDialog.showModal());
    $("#report-dialog .btn-close").click(() => reportDialog.close());


    // Filter
    $("#btn-filter").click(showFilterOptions);


    function showFilterOptions(event) {
      console.log(event.target);
      $("#filter-menu").css("top", `${event.clientY}px`);
      $("#filter-menu").css("left", `${event.clientX}px`);
      $("#filter-menu").show();
      $("#btn-filter").off('click', showFilterOptions);
      setTimeout(()=> $(document).click(hideFilterMenu), 100);
    }


    function hideFilterMenu(event) {
          const menu = $("#filter-menu");
          console.log('Hiding menu');
          menu.hide(); // Hide the menu
          $(document).off('click', hideFilterMenu);
          setTimeout(()=> $("#btn-filter").click(showFilterOptions), 100);
    }

    function filterUpcomingTasks() {
      renderTasks(kpi.tasks.filter(t => t.status === 0));
    }

    
    function filterCompletedTasks() {
      renderTasks(kpi.tasks.filter(t => t.status === 1));
    }


    function filterPastDueTasks() {
      renderTasks(kpi.tasks.filter(t => t.status === 2));
    }

    
    function removeFilter() {
      renderTasks(kpi.tasks);
    }
  </script>
</body>